# 技术评估文档

Melodot 为数据可用性层，它使得网络中的任何人都可以通过抽样来验证数据可用性，非不需要信任数据可用性层中的验证者。我们可以用一个简单的数学语言可以描述为 safe(DA, User) = safe(User) ，它为区块链的可扩展性带来了至关重要的作用。

当仍然有另一个未解决的问题，其他领域的用户如何知道数据是可用的？特别是不具备采样能力的领域，例如 L1 。Redot 是我们利用再质押来实现的一种近似于共识层安全性的解决方案，对手方需要攻击原始共识层才能攻击再质押层。

先前我们已经完成了 Melodot 的数据可用性层部分，这次黑客松完成了 Redot ，但为了保持完整性，我们仍然需要对 Melodot 进行相应描述。

## 动机

1. 使用领域化区块链对区块链进行重构
2. 让波卡成为全球共识层

## 术语

Melodot 获得过 W3F 的支持，但此次黑客松是完全另外一个生态项目，为了保持描述的完整性，我们依然对 Melodot 进行相应描述，在重要情况下我们会注明。

1. 农民： 在 Melodot 中实际负责分布式生成和数据存储的角色，使用基于 TMTO 的容量证明。
2. 最小诚实采样者数量假设： 这是数据可用性层的为数不多的假设，由于所有数据都从点对点网络中无需信任地获取，这要求采样的轻客户端数据足够多，以确保所有采样的数据足以重建数据，否则将会带来数据无法恢复的风险。这个假设直接决定了数据可用性层的安全性和吞吐量。
3. 分布式生成： 在 Melodot 语境中，分布式生成是指利用 KZG 多项式承诺的同态的特性，直接在列方向上扩展数据，而不需要获取所有数据计算 KZG 承诺和证明，这使得系统可以轻松应对大量数据。
4. 共识层： 领域化区块链中的共识层为其他领域达成共识，并非指某个链的共识层。
5. 再质押： 共识层的验证者使用其身份加入到另一个网络，类似于另一种形式的质押。
6. Task： Redot 使用 [**ZF FROST**](https://github.com/ZcashFoundation/frost) 实现了分布式密钥和阈值签名，验证者每人有一份密钥，任何人都无法恢复完整私钥，只有超过一定阈值的验证者人同意某一个 Task 的运行的结果才会获得最终签名，并提交到链上。

## 模块

### 已完成模块

1. 采样轻客户端： 用于执行采样并验证数据可用性的轻客户端，验证者将通过轻客户端完成 Task 。注：前期完成，不计入本次黑客松
2. 农民客户端：我们实现了一个PoV级别的基于 Hellman 的 TMTO 的存储证明，用于完成分布式生成和存储。注：前期完成，不计入本次黑客松。
3. Task： 密钥轮询，验证者在一定规则下重新生成密钥，并使用老密钥签名，从而更换密钥。任务被抽象为 metadata ，以允许不同类型的任务，而不仅仅是数据可用性
4. ValidatorNetwork： 验证者的点对点网络，用于分布式密钥生成和聚合签名。
5. ValidatorClient： 验证者客户端的核心模块。
6. ValidatorRegistry： 用于验证人注册的 Pallet。

### 截止时间之后完成的模块

由于时间限制，我们在截止时间之后完成了以下计划中的模块：

1. redoxt: 使用 subxt 搭建的节点交互和轻客户端组件
2. Redlight: 验证人实际执行任务的轻客户端，它依赖于 redoxt 和 ValidatorClient，通过调用 DAS 轻客户端的 RPC 来获取数据可用性，并将结果更新到链上。同时它也负责密钥轮换等必要操作。


## 代码目录

命名规则：

客户端以 rc 为前缀，即 redot client ，置于 crates 文件夹下，Pallet 以 pallet  为前缀，置于 pallets 文件夹下。

- /crates 实现 Redot 的相关 crate
    - /core-primitives Redot 的原语，包括 FROST 的包装和实现
    - /rc-validator 实际执行的验证人客户端核心逻辑，采用 Service-Worker 设计模式。
    - /rc-validator-fetch 抽象的验证人获取，支持从 runtime 获取和从波卡获取，以适应 runtime 环境和客户端环境。
    - /rc-validator-network 实现了基于 libp2p 的点对点网络，用于验证人发现，DKG 和 签名的点对点通信，采用 Service-Worker 设计模式
- /node Redot 的节点
- /pallets Redot 的相关 pallet
    - /task 验证人任务管理，包括密钥轮换和任务结果上传
    - /validator-registry 验证人注册，通过 OCW 同步波卡验证者进行识别
- /runtime 实现 Rodot 的 runtime

## **运行**

确保你已经正确搭建 rust 和 substrate 所需环境

### 编译

编译所有
```
make build
```

编译runtime
```
make build-runtime
```
### 测试

运行一下命令进行测试，目前主要为 DKG 和 阈值签名的测试
```
make test
```
### 运行

以下命令将启动一个开发链
```
make run-dev
```

通过以下命令编译 Redlight
```
make build-light
```